import{S as e,D as i,C as s,M as n,V as r,a as o,s as c,l as a,f as h,b as l,v as u,L as d,B as p,c as x,d as m,e as g,g as y,P as f,O as v,R as b,h as w,i as z,j as S,k as E,W as C,m as j,n as _,o as O,t as P,G as L,p as k,q as M,r as D,u as A,w as H,x as B,y as T,z as F,A as R,E as I,F as U}from"./vendor.117200f1.js";!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(i){const s=new URL(t,location),n=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((i,r)=>{const o=new URL(t,s);if(self[e].moduleMap[o])return i(self[e].moduleMap[o]);const c=new Blob([`import * as m from '${o}';`,`${e}.moduleMap['${o}']=m;`],{type:"text/javascript"}),a=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(c),onerror(){r(new Error(`Failed to import: ${t}`)),n(a)},onload(){i(self[e].moduleMap[o]),n(a)}});document.head.appendChild(a)})),self[e].moduleMap={}}}("assets/");class ${constructor(t,i,s=[],n=!0){this.camera=t,this.domElement=i,this.dragEnabled=n,this.draggingChangedSubject=new e,this.draggingChanged$=this.draggingChangedSubject.asObservable(),this.hoverObjectSubject=new e,this.hoverObject$=this.hoverObjectSubject.asObservable(),this.hoveredObject=null,this.objectMovedSubject=new e,this.objectMoved$=this.objectMovedSubject.asObservable(),this.objectDblClickSubject=new e,this.objectDblClick$=this.objectDblClickSubject.asObservable(),this.dragcontrols=this.createDragControls(s||[],this.camera,this.domElement),this.dblClickHandler=t=>{this.hoveredObject&&this.objectDblClickSubject.next([this.hoveredObject,t])},this.domElement.addEventListener("dblclick",this.dblClickHandler)}get objects(){return this.dragcontrols?this.dragcontrols.getObjects():[]}dispose(){this.dragcontrols.dispose(),this.domElement.removeEventListener("dblclick",this.dblClickHandler)}createDragControls(t,e,s){const n=new i(t,e,s);return n.addEventListener("hoveron",(t=>{this.hoveredObject=t.object,this.hoverObjectSubject.next(this.hoveredObject)})),n.addEventListener("hoveroff",(()=>{this.hoveredObject=null,this.hoverObjectSubject.next(this.hoveredObject)})),n.addEventListener("dragstart",(t=>{const e=t.object;this.startMovePosition=e.position.clone(),this.draggingChangedSubject.next(e)})),n.addEventListener("dragend",(t=>{this.draggingChangedSubject.next(null)})),n.addEventListener("drag",(t=>{const e=t.object;e&&this.startMovePosition&&(this.dragEnabled||e.position.copy(this.startMovePosition),this.objectMovedSubject.next([e,this.startMovePosition]))})),n}setObjects(t){this.dragcontrols.dispose(),this.dragcontrols=this.createDragControls(t,this.camera,this.domElement)}addObjects(t){this.setObjects([...this.dragcontrols.getObjects(),...t])}removeObjects(t){const e=[...this.dragcontrols.getObjects()];t.forEach((t=>{const i=e.indexOf(t);i>-1&&e.splice(i,1)})),this.setObjects(e)}}var N,V;(V=N||(N={}))[V.BoundingBox=1]="BoundingBox",V[V.DrillbitPoint=2]="DrillbitPoint";class G{constructor(t){this.specs=t,this.boundingBox={x:{min:0,max:this.specs.maxWidth/2},y:{min:-this.specs.maxHeight/2,max:this.specs.maxHeight/2}},this.drillbitGeom=new s(this.specs.drillbitRadius,32),this.drillbitMat=new n({color:16729156})}validate(t,e){const i=(e?[e]:t).reduce(((e,i)=>[...e,...this.getSegmentErrors(i,t)]),[]);return Promise.resolve(i)}getSegmentErrors(t,e){return[...this.validateBoundingBox(t,this.boundingBox)?[]:[{errorCode:1,errorName:"bbox"}],...this.getSegmentDrillbitErrors(t,e,this.specs.drillbitRadius,this.specs.drillbitSpacing).map((t=>({errorCode:2,errorName:"dbit",t:t})))]}validateBoundingBox(t,e){const i=t.bbox();return!(i.x.min<e.x.min||i.x.max>e.x.max||i.y.min<e.y.min||i.y.max>e.y.max)}getSegmentDrillbitErrors(t,e,i,s,n=40){return[]}createVisual(t,e){if(2===e.errorCode&&void 0!==e.t)return this.createDrillbitMeshForError(t,e.t)}createDrillbitMeshForError(t,e){const i=t.offset(e,-this.specs.drillbitRadius-this.specs.drillbitSpacing);return this.createDrillbitMesh(new r(i.x,i.y,0))}createDrillbitMesh(t){var e=new o(this.drillbitGeom,this.drillbitMat);return e.position.copy(t),e.scale.set(this.specs.drillbitRadius,this.specs.drillbitRadius,this.specs.drillbitRadius),e.castShadow=!1,e.receiveShadow=!1,e}}const{abs:W,cos:Y,sin:X,acos:q,atan2:Q,sqrt:J,pow:Z}=Math;function K(t){return t<0?-Z(-t,1/3):Z(t,1/3)}const tt=Math.PI,et=2*tt,it=tt/2,st=Number.MAX_SAFE_INTEGER||9007199254740991,nt=Number.MIN_SAFE_INTEGER||-9007199254740991,rt={x:0,y:0,z:0},ot={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){const i=e(t);let s=i.x*i.x+i.y*i.y;return void 0!==i.z&&(s+=i.z*i.z),J(s)},compute:function(t,e,i){if(0===t)return e[0].t=0,e[0];const s=e.length-1;if(1===t)return e[s].t=1,e[s];const n=1-t;let r=e;if(0===s)return e[0].t=t,e[0];if(1===s){const e={x:n*r[0].x+t*r[1].x,y:n*r[0].y+t*r[1].y,t:t};return i&&(e.z=n*r[0].z+t*r[1].z),e}if(s<4){let e,o,c,a=n*n,h=t*t,l=0;2===s?(r=[r[0],r[1],r[2],rt],e=a,o=n*t*2,c=h):3===s&&(e=a*n,o=a*t*3,c=n*h*3,l=t*h);const u={x:e*r[0].x+o*r[1].x+c*r[2].x+l*r[3].x,y:e*r[0].y+o*r[1].y+c*r[2].y+l*r[3].y,t:t};return i&&(u.z=e*r[0].z+o*r[1].z+c*r[2].z+l*r[3].z),u}const o=JSON.parse(JSON.stringify(e));for(;o.length>1;){for(let e=0;e<o.length-1;e++)o[e]={x:o[e].x+(o[e+1].x-o[e].x)*t,y:o[e].y+(o[e+1].y-o[e].y)*t},void 0!==o[e].z&&(o[e]=o[e].z+(o[e+1].z-o[e].z)*t);o.splice(o.length-1,1)}return o[0].t=t,o[0]},computeWithRatios:function(t,e,i,s){const n=1-t,r=i,o=e;let c,a=r[0],h=r[1],l=r[2],u=r[3];return a*=n,h*=t,2===o.length?(c=a+h,{x:(a*o[0].x+h*o[1].x)/c,y:(a*o[0].y+h*o[1].y)/c,z:!!s&&(a*o[0].z+h*o[1].z)/c,t:t}):(a*=n,h*=2*n,l*=t*t,3===o.length?(c=a+h+l,{x:(a*o[0].x+h*o[1].x+l*o[2].x)/c,y:(a*o[0].y+h*o[1].y+l*o[2].y)/c,z:!!s&&(a*o[0].z+h*o[1].z+l*o[2].z)/c,t:t}):(a*=n,h*=1.5*n,l*=3*n,u*=t*t*t,4===o.length?(c=a+h+l+u,{x:(a*o[0].x+h*o[1].x+l*o[2].x+u*o[3].x)/c,y:(a*o[0].y+h*o[1].y+l*o[2].y+u*o[3].y)/c,z:!!s&&(a*o[0].z+h*o[1].z+l*o[2].z+u*o[3].z)/c,t:t}):void 0))},derive:function(t,e){const i=[];for(let s=t,n=s.length,r=n-1;n>1;n--,r--){const t=[];for(let i,n=0;n<r;n++)i={x:r*(s[n+1].x-s[n].x),y:r*(s[n+1].y-s[n].y)},e&&(i.z=r*(s[n+1].z-s[n].z)),t.push(i);i.push(t),s=t}return i},between:function(t,e,i){return e<=t&&t<=i||ot.approximately(t,e)||ot.approximately(t,i)},approximately:function(t,e,i){return W(t-e)<=(i||1e-6)},length:function(t){const e=ot.Tvalues.length;let i=0;for(let s,n=0;n<e;n++)s=.5*ot.Tvalues[n]+.5,i+=ot.Cvalues[n]*ot.arcfn(s,t);return.5*i},map:function(t,e,i,s,n){return s+(n-s)*((t-e)/(i-e))},lerp:function(t,e,i){const s={x:e.x+t*(i.x-e.x),y:e.y+t*(i.y-e.y)};return e.z&&i.z&&(s.z=e.z+t*(i.z-e.z)),s},pointToString:function(t){let e=t.x+"/"+t.y;return void 0!==t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map(ot.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,i){const s=e.x-t.x,n=e.y-t.y,r=i.x-t.x,o=i.y-t.y;return Q(s*o-n*r,s*r+n*o)},round:function(t,e){const i=""+t,s=i.indexOf(".");return parseFloat(i.substring(0,s+1+e))},dist:function(t,e){const i=t.x-e.x,s=t.y-e.y;return J(i*i+s*s)},closest:function(t,e){let i,s,n=Z(2,63);return t.forEach((function(t,r){s=ot.dist(e,t),s<n&&(n=s,i=r)})),{mdist:n,mpos:i}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const i=Z(t,e)+Z(1-t,e);return W((i-1)/i)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const i=Z(1-t,e);return i/(Z(t,e)+i)},lli8:function(t,e,i,s,n,r,o,c){const a=(t-i)*(r-c)-(e-s)*(n-o);return 0!=a&&{x:((t*s-e*i)*(n-o)-(t-i)*(n*c-r*o))/a,y:((t*s-e*i)*(r-c)-(e-s)*(n*c-r*o))/a}},lli4:function(t,e,i,s){const n=t.x,r=t.y,o=e.x,c=e.y,a=i.x,h=i.y,l=s.x,u=s.y;return ot.lli8(n,r,o,c,a,h,l,u)},lli:function(t,e){return ot.lli4(t,t.c,e,e.c)},makeline:function(t,e){const i=t.x,s=t.y,n=e.x,r=e.y,o=(n-i)/3,c=(r-s)/3;return new gt(i,s,i+o,s+c,i+2*o,s+2*c,n,r)},findbbox:function(t){let e=st,i=st,s=nt,n=nt;return t.forEach((function(t){const r=t.bbox();e>r.x.min&&(e=r.x.min),i>r.y.min&&(i=r.y.min),s<r.x.max&&(s=r.x.max),n<r.y.max&&(n=r.y.max)})),{x:{min:e,mid:(e+s)/2,max:s,size:s-e},y:{min:i,mid:(i+n)/2,max:n,size:n-i}}},shapeintersections:function(t,e,i,s,n){if(!ot.bboxoverlap(e,s))return[];const r=[],o=[t.startcap,t.forward,t.back,t.endcap],c=[i.startcap,i.forward,i.back,i.endcap];return o.forEach((function(e){e.virtual||c.forEach((function(s){if(s.virtual)return;const o=e.intersects(s,n);o.length>0&&(o.c1=e,o.c2=s,o.s1=t,o.s2=i,r.push(o))}))})),r},makeshape:function(t,e,i){const s=e.points.length,n=t.points.length,r=ot.makeline(e.points[s-1],t.points[0]),o=ot.makeline(t.points[n-1],e.points[0]),c={startcap:r,forward:t,back:e,endcap:o,bbox:ot.findbbox([r,t,e,o]),intersections:function(t){return ot.shapeintersections(c,c.bbox,t,t.bbox,i)}};return c},getminmax:function(t,e,i){if(!i)return{min:0,max:0};let s,n,r=st,o=nt;-1===i.indexOf(0)&&(i=[0].concat(i)),-1===i.indexOf(1)&&i.push(1);for(let c=0,a=i.length;c<a;c++)s=i[c],n=t.get(s),n[e]<r&&(r=n[e]),n[e]>o&&(o=n[e]);return{min:r,mid:(r+o)/2,max:o,size:o-r}},align:function(t,e){const i=e.p1.x,s=e.p1.y,n=-Q(e.p2.y-s,e.p2.x-i);return t.map((function(t){return{x:(t.x-i)*Y(n)-(t.y-s)*X(n),y:(t.x-i)*X(n)+(t.y-s)*Y(n)}}))},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const i=t.length-1,s=ot.align(t,e),n=function(t){return 0<=t&&t<=1};if(2===i){const t=s[0].y,e=s[1].y,i=s[2].y,r=t-2*e+i;if(0!==r){const s=-J(e*e-t*i),o=-t+e;return[-(s+o)/r,-(-s+o)/r].filter(n)}return e!==i&&0===r?[(2*e-i)/(2*e-2*i)].filter(n):[]}const r=s[0].y,o=s[1].y,c=s[2].y;let a=3*o-r-3*c+s[3].y,h=3*r-6*o+3*c,l=-3*r+3*o,u=r;if(ot.approximately(a,0)){if(ot.approximately(h,0))return ot.approximately(l,0)?[]:[-u/l].filter(n);const t=J(l*l-4*h*u),e=2*h;return[(t-l)/e,(-l-t)/e].filter(n)}h/=a,l/=a,u/=a;const d=(3*l-h*h)/3,p=d/3,x=(2*h*h*h-9*h*l+27*u)/27,m=x/2,g=m*m+p*p*p;let y,f,v,b,w;if(g<0){const t=-d/3,e=J(t*t*t),i=-x/(2*e),s=q(i<-1?-1:i>1?1:i),r=2*K(e);return v=r*Y(s/3)-h/3,b=r*Y((s+et)/3)-h/3,w=r*Y((s+2*et)/3)-h/3,[v,b,w].filter(n)}if(0===g)return y=m<0?K(-m):-K(m),v=2*y-h/3,b=-y-h/3,[v,b].filter(n);{const t=J(g);return y=K(-m+t),f=K(m+t),[y-f-h/3].filter(n)}},droots:function(t){if(3===t.length){const e=t[0],i=t[1],s=t[2],n=e-2*i+s;if(0!==n){const t=-J(i*i-e*s),r=-e+i;return[-(t+r)/n,-(-t+r)/n]}return i!==s&&0===n?[(2*i-s)/(2*(i-s))]:[]}if(2===t.length){const e=t[0],i=t[1];return e!==i?[e/(e-i)]:[]}return[]},curvature:function(t,e,i,s,n){let r,o,c,a,h=0,l=0;const u=ot.compute(t,e),d=ot.compute(t,i),p=u.x*u.x+u.y*u.y;if(s?(r=J(Z(u.y*d.z-d.y*u.z,2)+Z(u.z*d.x-d.z*u.x,2)+Z(u.x*d.y-d.x*u.y,2)),o=Z(p+u.z*u.z,1.5)):(r=u.x*d.y-u.y*d.x,o=Z(p,1.5)),0===r||0===o)return{k:0,r:0};if(h=r/o,l=o/r,!n){const n=ot.curvature(t-.001,e,i,s,!0).k,r=ot.curvature(t+.001,e,i,s,!0).k;a=(r-h+(h-n))/2,c=(W(r-h)+W(h-n))/2}return{k:h,r:l,dk:a,adk:c}},inflections:function(t){if(t.length<4)return[];const e=ot.align(t,{p1:t[0],p2:t.slice(-1)[0]}),i=e[2].x*e[1].y,s=e[3].x*e[1].y,n=e[1].x*e[2].y,r=18*(-3*i+2*s+3*n-e[3].x*e[2].y),o=18*(3*i-s-3*n),c=18*(n-i);if(ot.approximately(r,0)){if(!ot.approximately(o,0)){let t=-c/o;if(0<=t&&t<=1)return[t]}return[]}const a=o*o-4*r*c,h=Math.sqrt(a),l=2*r;return ot.approximately(l,0)?[]:[(h-o)/l,-(o+h)/l].filter((function(t){return 0<=t&&t<=1}))},bboxoverlap:function(t,e){const i=["x","y"],s=i.length;for(let n,r,o,c,a=0;a<s;a++)if(n=i[a],r=t[n].mid,o=e[n].mid,c=(t[n].size+e[n].size)/2,W(r-o)>=c)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,i){const s=t.bbox(),n=e.bbox(),r=1e5,o=i||.5;if(s.x.size+s.y.size<o&&n.x.size+n.y.size<o)return[(r*(t._t1+t._t2)/2|0)/r+"/"+(r*(e._t1+e._t2)/2|0)/r];let c=t.split(.5),a=e.split(.5),h=[{left:c.left,right:a.left},{left:c.left,right:a.right},{left:c.right,right:a.right},{left:c.right,right:a.left}];h=h.filter((function(t){return ot.bboxoverlap(t.left.bbox(),t.right.bbox())}));let l=[];return 0===h.length||(h.forEach((function(t){l=l.concat(ot.pairiteration(t.left,t.right,o))})),l=l.filter((function(t,e){return l.indexOf(t)===e}))),l},getccenter:function(t,e,i){const s=e.x-t.x,n=e.y-t.y,r=i.x-e.x,o=i.y-e.y,c=s*Y(it)-n*X(it),a=s*X(it)+n*Y(it),h=r*Y(it)-o*X(it),l=r*X(it)+o*Y(it),u=(t.x+e.x)/2,d=(t.y+e.y)/2,p=(e.x+i.x)/2,x=(e.y+i.y)/2,m=u+c,g=d+a,y=p+h,f=x+l,v=ot.lli8(u,d,m,g,p,x,y,f),b=ot.dist(v,t);let w,z=Q(t.y-v.y,t.x-v.x),S=Q(e.y-v.y,e.x-v.x),E=Q(i.y-v.y,i.x-v.x);return z<E?((z>S||S>E)&&(z+=et),z>E&&(w=E,E=z,z=w)):E<S&&S<z?(w=E,E=z,z=w):E+=et,v.s=z,v.e=E,v.r=b,v},numberSort:function(t,e){return t-e}};class ct{constructor(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map((function(t){return ot.pointsToString(t.points)})).join(", ")+"]"}addCurve(t){this.curves.push(t),this._3d=this._3d||t._3d}length(){return this.curves.map((function(t){return t.length()})).reduce((function(t,e){return t+e}))}curve(t){return this.curves[t]}bbox(){const t=this.curves;for(var e=t[0].bbox(),i=1;i<t.length;i++)ot.expandbox(e,t[i].bbox());return e}offset(t){const e=[];return this.curves.forEach((function(i){e.push(...i.offset(t))})),new ct(e)}}const{abs:at,min:ht,max:lt,cos:ut,sin:dt,acos:pt,sqrt:xt}=Math,mt=Math.PI;class gt{constructor(...t){let e=t&&t.forEach?t:Array.from(arguments).slice(),i=!1;if("object"==typeof e[0]){i=e.length;const t=[];e.forEach((function(e){["x","y","z"].forEach((function(i){void 0!==e[i]&&t.push(e[i])}))})),e=t}let s=!1;const n=e.length;if(i){if(i>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");s=!0}}else if(6!==n&&8!==n&&9!==n&&12!==n&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const r=this._3d=!s&&(9===n||12===n)||t&&t[0]&&void 0!==t[0].z,o=this.points=[];for(let u=0,d=r?3:2;u<n;u+=d){var c={x:e[u],y:e[u+1]};r&&(c.z=e[u+2]),o.push(c)}const a=this.order=o.length-1,h=this.dims=["x","y"];r&&h.push("z"),this.dimlen=h.length;const l=ot.align(o,{p1:o[0],p2:o[a]});this._linear=!l.some((t=>at(t.y)>1e-4)),this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(t,e,i,s){if(void 0===s&&(s=.5),0===s)return new gt(e,e,i);if(1===s)return new gt(t,e,e);const n=gt.getABC(2,t,e,i,s);return new gt(t,n.A,i)}static cubicFromPoints(t,e,i,s,n){void 0===s&&(s=.5);const r=gt.getABC(3,t,e,i,s);void 0===n&&(n=ot.dist(e,r.C));const o=n*(1-s)/s,c=ot.dist(t,i),a=(i.x-t.x)/c,h=(i.y-t.y)/c,l=n*a,u=n*h,d=o*a,p=o*h,x=e.x-l,m=e.y-u,g=e.x+d,y=e.y+p,f=r.A,v=f.x+(x-f.x)/(1-s),b=f.y+(m-f.y)/(1-s),w=f.x+(g-f.x)/s,z=f.y+(y-f.y)/s,S={x:t.x+(v-t.x)/s,y:t.y+(b-t.y)/s},E={x:i.x+(w-i.x)/(1-s),y:i.y+(z-i.y)/(1-s)};return new gt(t,S,E,i)}static getUtils(){return ot}getUtils(){return gt.getUtils()}static get PolyBezier(){return ct}valueOf(){return this.toString()}toString(){return ot.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const t=this.points,e=["M",t[0].x,t[0].y,2===this.order?"Q":"C"];for(let i=1,s=t.length;i<s;i++)e.push(t[i].x),e.push(t[i].y);return e.join(" ")}setRatios(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}verify(){const t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}coordDigest(){return this.points.map((function(t,e){return""+e+t.x+t.y+(t.z?t.z:0)})).join("")}update(){this._lut=[],this.dpoints=ot.derive(this.points,this._3d),this.computedirection()}computedirection(){const t=this.points,e=ot.angle(t[0],t[this.order],t[1]);this.clockwise=e>0}length(){return ot.length(this.derivative.bind(this))}static getABC(t=2,e,i,s,n=.5){const r=ot.projectionratio(n,t),o=1-r,c={x:r*e.x+o*s.x,y:r*e.y+o*s.y},a=ot.abcratio(n,t);return{A:{x:i.x+(i.x-c.x)/a,y:i.y+(i.y-c.y)/a},B:i,C:c,S:e,E:s}}getABC(t,e){e=e||this.get(t);let i=this.points[0],s=this.points[this.order];return gt.getABC(this.order,i,e,s,t)}getLUT(t){if(this.verify(),t=t||100,this._lut.length===t)return this._lut;this._lut=[],t--;for(let e,i,s=0;s<t;s++)i=s/(t-1),e=this.compute(i),e.t=i,this._lut.push(e);return this._lut}on(e,i){i=i||5;const s=this.getLUT(),n=[];for(let t,r=0,o=0;r<s.length;r++)t=s[r],ot.dist(t,e)<i&&(n.push(t),o+=r/s.length);return!!n.length&&(t/=n.length)}project(t){const e=this.getLUT(),i=e.length-1,s=ot.closest(e,t),n=s.mpos,r=(n-1)/i,o=(n+1)/i,c=.1/i;let a,h,l=s.mdist,u=r,d=u;for(l+=1;u<o+c;u+=c)a=this.compute(u),h=ot.dist(t,a),h<l&&(l=h,d=u);return d=d<0?0:d>1?1:d,a=this.compute(d),a.t=d,a.d=l,a}get(t){return this.compute(t)}point(t){return this.points[t]}compute(t){return this.ratios?ot.computeWithRatios(t,this.points,this.ratios,this._3d):ot.compute(t,this.points,this._3d,this.ratios)}raise(){const t=this.points,e=[t[0]],i=t.length;for(let s,n,r=1;r<i;r++)s=t[r],n=t[r-1],e[r]={x:(i-r)/i*s.x+r/i*n.x,y:(i-r)/i*s.y+r/i*n.y};return e[i]=t[i-1],new gt(e)}derivative(t){return ot.compute(t,this.dpoints[0],this._3d)}dderivative(t){return ot.compute(t,this.dpoints[1],this._3d)}align(){let t=this.points;return new gt(ot.align(t,{p1:t[0],p2:t[t.length-1]}))}curvature(t){return ot.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return ot.inflections(this.points)}normal(t){return this._3d?this.__normal3(t):this.__normal2(t)}__normal2(t){const e=this.derivative(t),i=xt(e.x*e.x+e.y*e.y);return{x:-e.y/i,y:e.x/i}}__normal3(t){const e=this.derivative(t),i=this.derivative(t+.01),s=xt(e.x*e.x+e.y*e.y+e.z*e.z),n=xt(i.x*i.x+i.y*i.y+i.z*i.z);e.x/=s,e.y/=s,e.z/=s,i.x/=n,i.y/=n,i.z/=n;const r={x:i.y*e.z-i.z*e.y,y:i.z*e.x-i.x*e.z,z:i.x*e.y-i.y*e.x},o=xt(r.x*r.x+r.y*r.y+r.z*r.z);r.x/=o,r.y/=o,r.z/=o;const c=[r.x*r.x,r.x*r.y-r.z,r.x*r.z+r.y,r.x*r.y+r.z,r.y*r.y,r.y*r.z-r.x,r.x*r.z-r.y,r.y*r.z+r.x,r.z*r.z];return{x:c[0]*e.x+c[1]*e.y+c[2]*e.z,y:c[3]*e.x+c[4]*e.y+c[5]*e.z,z:c[6]*e.x+c[7]*e.y+c[8]*e.z}}hull(t){let e=this.points,i=[],s=[],n=0;for(s[n++]=e[0],s[n++]=e[1],s[n++]=e[2],3===this.order&&(s[n++]=e[3]);e.length>1;){i=[];for(let r,o=0,c=e.length-1;o<c;o++)r=ot.lerp(t,e[o],e[o+1]),s[n++]=r,i.push(r);e=i}return s}split(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;const i=this.hull(t),s={left:2===this.order?new gt(i[0],i[3],i[5]):new gt(i[0],i[4],i[7],i[9]),right:2===this.order?new gt(i[5],i[4],i[2]):new gt(i[9],i[8],i[6],i[3]),span:i};return s.left._t1=ot.map(0,0,1,this._t1,this._t2),s.left._t2=ot.map(t,0,1,this._t1,this._t2),s.right._t1=ot.map(t,0,1,this._t1,this._t2),s.right._t2=ot.map(1,0,1,this._t1,this._t2),e?(e=ot.map(e,t,1,0,1),s.right.split(e).left):s}extrema(){const t={};let e=[];return this.dims.forEach(function(i){let s=function(t){return t[i]},n=this.dpoints[0].map(s);t[i]=ot.droots(n),3===this.order&&(n=this.dpoints[1].map(s),t[i]=t[i].concat(ot.droots(n))),t[i]=t[i].filter((function(t){return t>=0&&t<=1})),e=e.concat(t[i].sort(ot.numberSort))}.bind(this)),t.values=e.sort(ot.numberSort).filter((function(t,i){return e.indexOf(t)===i})),t}bbox(){const t=this.extrema(),e={};return this.dims.forEach(function(i){e[i]=ot.getminmax(this,i,t[i])}.bind(this)),e}overlaps(t){const e=this.bbox(),i=t.bbox();return ot.bboxoverlap(e,i)}offset(t,e){if(void 0!==e){const i=this.get(t),s=this.normal(t),n={c:i,n:s,x:i.x+s.x*e,y:i.y+s.y*e};return this._3d&&(n.z=i.z+s.z*e),n}if(this._linear){const e=this.normal(0),i=this.points.map((function(i){const s={x:i.x+t*e.x,y:i.y+t*e.y};return i.z&&e.z&&(s.z=i.z+t*e.z),s}));return[new gt(i)]}return this.reduce().map((function(e){return e._linear?e.offset(t)[0]:e.scale(t)}))}simple(){if(3===this.order){const t=ot.angle(this.points[0],this.points[3],this.points[1]),e=ot.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&e<0||t<0&&e>0)return!1}const t=this.normal(0),e=this.normal(1);let i=t.x*e.x+t.y*e.y;return this._3d&&(i+=t.z*e.z),at(pt(i))<mt/3}reduce(){let t,e,i=0,s=0,n=.01,r=[],o=[],c=this.extrema().values;for(-1===c.indexOf(0)&&(c=[0].concat(c)),-1===c.indexOf(1)&&c.push(1),i=c[0],t=1;t<c.length;t++)s=c[t],e=this.split(i,s),e._t1=i,e._t2=s,r.push(e),i=s;return r.forEach((function(t){for(i=0,s=0;s<=1;)for(s=i+n;s<=1.01;s+=n)if(e=t.split(i,s),!e.simple()){if(s-=n,at(i-s)<n)return[];e=t.split(i,s),e._t1=ot.map(i,0,1,t._t1,t._t2),e._t2=ot.map(s,0,1,t._t1,t._t2),o.push(e),i=s;break}i<1&&(e=t.split(i,1),e._t1=ot.map(i,0,1,t._t1,t._t2),e._t2=t._t2,o.push(e))})),o}scale(t){const e=this.order;let i=!1;if("function"==typeof t&&(i=t),i&&2===e)return this.raise().scale(i);const s=this.clockwise,n=i?i(0):t,r=i?i(1):t,o=[this.offset(0,10),this.offset(1,10)],c=this.points,a=[],h=ot.lli4(o[0],o[0].c,o[1],o[1].c);if(!h)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach((function(t){const i=a[t*e]=ot.copy(c[t*e]);i.x+=(t?r:n)*o[t].n.x,i.y+=(t?r:n)*o[t].n.y})),i?([0,1].forEach((function(n){if(2!==e||!n){var r=c[n+1],o={x:r.x-h.x,y:r.y-h.y},l=i?i((n+1)/e):t;i&&!s&&(l=-l);var u=xt(o.x*o.x+o.y*o.y);o.x/=u,o.y/=u,a[n+1]={x:r.x+l*o.x,y:r.y+l*o.y}}})),new gt(a)):([0,1].forEach((t=>{if(2===e&&t)return;const i=a[t*e],s=this.derivative(t),n={x:i.x+s.x,y:i.y+s.y};a[t+1]=ot.lli4(i,n,h,c[t+1])})),new gt(a))}outline(t,e,i,s){e=void 0===e?t:e;const n=this.reduce(),r=n.length,o=[];let c,a=[],h=0,l=this.length();const u=void 0!==i&&void 0!==s;function d(t,e,i,s,n){return function(r){const o=s/i,c=(s+n)/i,a=e-t;return ot.map(r,0,1,t+o*a,t+c*a)}}n.forEach((function(n){const r=n.length();u?(o.push(n.scale(d(t,i,l,h,r))),a.push(n.scale(d(-e,-s,l,h,r)))):(o.push(n.scale(t)),a.push(n.scale(-e))),h+=r})),a=a.map((function(t){return c=t.points,c[3]?t.points=[c[3],c[2],c[1],c[0]]:t.points=[c[2],c[1],c[0]],t})).reverse();const p=o[0].points[0],x=o[r-1].points[o[r-1].points.length-1],m=a[r-1].points[a[r-1].points.length-1],g=a[0].points[0],y=ot.makeline(m,p),f=ot.makeline(x,g),v=[y].concat(o).concat([f]).concat(a);return new ct(v)}outlineshapes(t,e,i){e=e||t;const s=this.outline(t,e).curves,n=[];for(let r=1,o=s.length;r<o/2;r++){const t=ot.makeshape(s[r],s[o-r],i);t.startcap.virtual=r>1,t.endcap.virtual=r<o/2-1,n.push(t)}return n}intersects(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof gt&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)}lineIntersects(t){const e=ht(t.p1.x,t.p2.x),i=ht(t.p1.y,t.p2.y),s=lt(t.p1.x,t.p2.x),n=lt(t.p1.y,t.p2.y);return ot.roots(this.points,t).filter((t=>{var r=this.get(t);return ot.between(r.x,e,s)&&ot.between(r.y,i,n)}))}selfintersects(t){const e=this.reduce(),i=e.length-2,s=[];for(let n,r,o,c=0;c<i;c++)r=e.slice(c,c+1),o=e.slice(c+2),n=this.curveintersects(r,o,t),s.push(...n);return s}curveintersects(t,e,i){const s=[];t.forEach((function(t){e.forEach((function(e){t.overlaps(e)&&s.push({left:t,right:e})}))}));let n=[];return s.forEach((function(t){const e=ot.pairiteration(t.left,t.right,i);e.length>0&&(n=n.concat(e))})),n}arcs(t){return t=t||.5,this._iterate(t,[])}_error(t,e,i,s){const n=(s-i)/4,r=this.get(i+n),o=this.get(s-n),c=ot.dist(t,e),a=ot.dist(t,r),h=ot.dist(t,o);return at(a-c)+at(h-c)}_iterate(t,e){let i,s=0,n=1;do{i=0,n=1;let r,o,c,a,h,l=this.get(s),u=!1,d=!1,p=n,x=1;do{if(d=u,a=c,p=(s+n)/2,r=this.get(p),o=this.get(n),c=ot.getccenter(l,r,o),c.interval={start:s,end:n},u=this._error(c,l,s,n)<=t,h=d&&!u,h||(x=n),u){if(n>=1){if(c.interval.end=x=1,a=c,n>1){let t={x:c.x+c.r*ut(c.e),y:c.y+c.r*dt(c.e)};c.e+=ot.angle({x:c.x,y:c.y},t,this.get(1))}break}n+=(n-s)/2}else n=p}while(!h&&i++<100);if(i>=100)break;a=a||c,e.push(a),s=x}while(n<1);return e}}const yt=t=>({x:t.x,y:t.y});function ft(t,e=(t=>t)){return i=t.positions.map((t=>e(t))),new gt(yt(i[0]).x,yt(i[0]).y,yt(i[1]).x,yt(i[1]).y,yt(i[2]).x,yt(i[2]).y,yt(i[3]).x,yt(i[3]).y);var i}function vt(t){return t.map((t=>new l(t.x,t.y)))}function bt(t){return c.parseSVG(t).reduce(((t,e)=>{if("M"===e.code)return[...t,{x:e.x,y:e.y}];const i=t[t.length-1];if("L"===e.code){const s={x:e.x,y:e.y},n={x:s.x-i.x,y:s.y-i.y},r=.3;return[...t,{x:i.x+n.x*r,y:i.y+n.y*r},{x:i.x+n.x*(1-r),y:i.y+n.y*(1-r)},s]}return"C"===e.code?[...t,{x:e.x1,y:e.y1},{x:e.x2,y:e.y2},{x:e.x,y:e.y}]:(console.warn("[svgFromPathSource] unsupported SVG command code: ",e.code),[...t])}),[])}function wt(t,e=1){const i=a.chunk(t,4).filter((t=>4===t.length)).reduce(((t,e)=>[...t,...new gt(e[0].x,e[0].y,e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y).getLUT(4).map((t=>[t.x,t.y]))]),[]);return h(i,e).reduce(((t,e)=>[...t,...e.map((t=>({x:t[0],y:t[1]})))]),[])}class zt{constructor(t,e){this.objects=t,this.scene=e,this.ARC_SEGMENTS=100,this.SHADOWS_ENABLED=!1,this.CLR_DEFAULT=0,this.CLR_HOVERED=8947712,this.CLR_INVALID=16711680,this.CLR_HOVERED_INVALID=16746632,this.handleLines=[],this.destroyFuncs=[],this.lineMaterial=new d({color:0,opacity:1}),this.isValid=!0,this.isHovered=!1,this.isFirst=!1,this.isLast=!1,this.validationQueues=[],4!==t.length&&console.warn("[Segment.ctor] objects.length !== 4"),this.objects.forEach((t=>this.scene.add(t)));var i=new p;i.setAttribute("position",new x(new Float32Array(3*this.ARC_SEGMENTS),3)),this.lineMesh=new m(i,this.lineMaterial),this.mirroredLineMesh=new m(i,this.lineMaterial.clone()),this.mirroredLineMesh.scale.set(-1,1,1),this.lineMesh.castShadow=this.SHADOWS_ENABLED,this.scene.add(this.lineMesh),this.scene.add(this.mirroredLineMesh),this.bezierCurve=new g(this.objects[0].position,this.objects[1].position,this.objects[2].position,this.objects[3].position);const s=new y({color:11184810,dashSize:10,gapSize:5});(i=new p).setFromPoints([this.objects[0].position,this.objects[1].position]),this.handleLines.push(new m(i,s)),(i=new p).setFromPoints([this.objects[3].position,this.objects[2].position]),this.handleLines.push(new m(i,s)),this.handleLines.forEach((t=>{t.position.set(0,0,1),e.add(t)})),this.updateCurve(),this.destroyFuncs.push((()=>{this.objects.forEach((t=>e.remove(t))),this.handleLines.forEach((t=>e.remove(t))),e.remove(this.lineMesh),e.remove(this.mirroredLineMesh)}))}get positions(){return this.objects.map((t=>t.position))}get bezier(){return ft(this)}destroy(){this.destroyFuncs.forEach((t=>t())),this.destroyFuncs.length=0}updateCurve(){if(!this.bezierCurve)return;var t=this.bezierCurve.getPoints(this.ARC_SEGMENTS);const e=this.lineMesh;e.geometry.setFromPoints(t),e.geometry.attributes.position.needsUpdate=!0,this.handleLines[0].geometry.setFromPoints([this.objects[0].position,this.objects[1].position]),this.handleLines[0].computeLineDistances(),this.handleLines[1].geometry.setFromPoints([this.objects[3].position,this.objects[2].position]),this.handleLines[1].computeLineDistances()}setHovered(t=!0){this.isHovered=t,this.updateCurveColor(this.isValid,this.isHovered)}setValid(t=!0,e=[]){this.isValid=t,this.updateCurveColor(this.isValid,this.isHovered),this.validationQueues.forEach((t=>this.scene.remove(t))),this.validationQueues=e,this.validationQueues.forEach((t=>this.scene.add(t)))}updateCurveColor(t,e){const i=e?t?this.CLR_HOVERED:this.CLR_HOVERED_INVALID:t?this.CLR_DEFAULT:this.CLR_INVALID;this.lineMaterial.color.set(i)}}const St={maxWidth:10.5,maxHeight:33.5,truckPinDistanceX:1.63,truckPinDistanceY:2.13,truckPinRadius:.2,distanceBetweenTrucks:14.25,noseLength:7.5,tailLength:7.5,autodeskScaleBugFactor:14.25/14.844,drillbitRadius:1,drillbitSpacing:.01};function Et(t,e){const i=new l(t.truckPinDistanceX,t.truckPinDistanceY);return[new l(-.5,.5),new l(-.5,-.5),new l(.5,-.5),new l(.5,.5)].map((t=>e.clone().add(i.clone().multiply(t))))}function Ct(t){return Et(t,new l(0,0-.5*t.distanceBetweenTrucks-.5*t.truckPinDistanceY))}function jt(t){return Et(t,new l(0,0+.5*t.distanceBetweenTrucks+.5*t.truckPinDistanceY))}class _t{constructor(t,i,r,c,h){var u,d,p;this.camera=t,this.domElement=r,this.SHADOWS_ENABLED=!1,this.segments=[],this.uiPointGeometry=new s(.5,32),this.uiPointMaterial=new n({color:16777028}),this.uiHandleMaterial=new n({color:14540066}),this.boundingBoxGeometry=new f(St.maxWidth,St.maxHeight,2),this.boundingMaterial=new n({color:14540253}),this.truckHoleGeom=new s(St.truckPinRadius,16),this.truckHoleMat=new n({color:2236962}),this.changeSubject=new e,this.change$=this.changeSubject.asObservable(),this.root=new v,void 0===h&&(h={}),void 0!==h.SHADOWS_ENABLED&&(this.SHADOWS_ENABLED=h.SHADOWS_ENABLED);const x=new o(this.boundingBoxGeometry,this.boundingMaterial);var m;x.position.set(0,0,-1),this.root.add(x),(m=St,[...jt(m),...Ct(m)]).forEach((t=>{const e=new o(this.truckHoleGeom,this.truckHoleMat);e.position.set(t.x,t.y,-.5),this.root.add(e)})),this.root.scale.set((null==(u=null==h?void 0:h.scale)?void 0:u.x)||1,(null==(d=null==h?void 0:h.scale)?void 0:d.y)||1,(null==(p=null==h?void 0:h.scale)?void 0:p.z)||1),i.add(this.root),this.controls=this.createControls(this.camera,this.domElement),this.lineInteractionControls=this.createLineInteractionControls(this.camera,this.domElement);const g=a.chunk(c||[],4).filter((t=>4===t.length));this.segments=g.reduce(((t,e,i)=>{const s=t.length>0?t[t.length-1].objects[3]:null;if(s&&new l(s.position.x,s.position.y),s){const t=new l(s.position.x,s.position.y),i=e[0];i.equals(t)||console.warn(`Previous segments endpoint (${t}) does not match with next segment start point (${i})`)}return[...t,this.createSegment([s||this.createUiPointObject(e[0],this.uiPointMaterial),this.createUiPointObject(e[1],this.uiHandleMaterial),this.createUiPointObject(e[2],this.uiHandleMaterial),this.createUiPointObject(e[3],this.uiPointMaterial)],0===i,i===g.length-1)]}),[])}createControls(t,e){const i=new $(t,e);return i.draggingChanged$.subscribe((t=>{if(t||!this.dragInfo)if(t){const e=this.getHandlePointsFor(t);this.dragInfo={point:t,handles:e.map((t=>({point:t,startPos:t.position.clone()})))}}else this.dragInfo=void 0;else a.uniq([...this.getSegmentsForPoint(this.dragInfo.point),...this.segments.filter((t=>!t.isValid))]).forEach((t=>this.validateSegment(t)))})),i.objectMoved$.subscribe((([t,e])=>{var i,s;if(this.dragInfo&&this.dragInfo.point===t){t!==(null==(i=this.segments.find((t=>t.isFirst)))?void 0:i.objects[0])&&t!==(null==(s=this.segments.find((t=>t.isLast)))?void 0:s.objects[3])||(t.position.x=0);const n=t.position.clone().sub(e);this.dragInfo.handles.forEach((t=>{t.point.position.copy(t.startPos.clone().add(n))}))}this.getSegmentsForPoint(t).forEach((t=>{t.updateCurve(),this.changeSubject.next()}))})),i.objectDblClick$.subscribe((([t])=>{var e,i;if(t===(null==(e=this.segments.find((t=>t.isFirst)))?void 0:e.objects[0])||t===(null==(i=this.segments.find((t=>t.isLast)))?void 0:i.objects[3]))return;const s=this.getSegmentsForPoint(t);for(let n=s.length-1;n>=1;n--)this.joinSegments(s[n-1],s[n])})),i}createLineInteractionControls(t,e){const i=new $(t,e,[],!1);return i.hoverObject$.subscribe((t=>{this.segments.forEach((e=>{const i=e.lineMesh===t;e.setHovered(i)}))})),i.objectDblClick$.subscribe((([t,e])=>{const i=this.segments.find((e=>e.lineMesh===t));if(i){const t=this.getHitPos(i,e);t&&this.splitSegment(i,t)}})),i}createSegment(t,e,i){const s=new zt(t,this.root);return s.isFirst=e,s.isLast=i,this.controls.addObjects(t),this.lineInteractionControls.addObjects([s.lineMesh]),s}removeSegment(t){this.controls.removeObjects(t.objects),this.lineInteractionControls.removeObjects([t.lineMesh]),t.destroy(),this.segments.splice(this.segments.indexOf(t),1)}splitSegment(t,e){const i=t.bezier,s=function(t,e,i){let s,n=0;const r=1/(i||50),o=t.project(e);for(var c=0;c<=1;c+=r){const e=t.get(c),i=new u(o.x-e.x,o.y-e.y).length();(void 0===s||i<s)&&(n=c,s=i)}return n}(i,{x:e.x,y:e.y}),n=i.split(s);this.removeSegment(t);var r=[...n.left.points,n.right.points[1],n.right.points[2],n.right.points[3]],o=[this.createUiPointObject(new l(r[0].x,r[0].y),this.uiPointMaterial),this.createUiPointObject(new l(r[1].x,r[1].y),this.uiHandleMaterial),this.createUiPointObject(new l(r[2].x,r[2].y),this.uiHandleMaterial),this.createUiPointObject(new l(r[3].x,r[3].y),this.uiPointMaterial),this.createUiPointObject(new l(r[4].x,r[4].y),this.uiHandleMaterial),this.createUiPointObject(new l(r[5].x,r[5].y),this.uiHandleMaterial),this.createUiPointObject(new l(r[6].x,r[6].y),this.uiPointMaterial)];const c=this.createSegment([o[0],o[1],o[2],o[3]],t.isFirst,!1),a=this.createSegment([o[3],o[4],o[5],o[6]],!1,t.isLast);this.segments.push(c),this.segments.push(a)}joinSegments(t,e){this.removeSegment(t),this.removeSegment(e);const i=this.createSegment([t.objects[0],t.objects[1],e.objects[2],e.objects[3]],t.isFirst||e.isFirst,t.isLast||e.isLast);this.segments.push(i)}getSegmentsForPoint(t){return this.segments.filter((e=>e.objects.indexOf(t)>-1))}async validateSegment(t){const e=new G(St),i=await e.validate(this.segments.map((t=>t.bezier)),t.bezier);if(0===i.length)return void t.setValid(!0);console.log("Validation failed: ",i);const s=i.map((i=>e.createVisual(t.bezier,i))).filter((t=>t));t.setValid(!1,s)}createUiPointObject(t,e){var i=new o(this.uiPointGeometry,e);return i.position.copy(new r(t.x,t.y,0)),i.castShadow=this.SHADOWS_ENABLED,i.receiveShadow=this.SHADOWS_ENABLED,i}getHandlePointsFor(t){return[...this.segments.filter((e=>0===e.objects.indexOf(t))).map((t=>t.objects[1])),...this.segments.filter((e=>3===e.objects.indexOf(t))).map((t=>t.objects[2]))]}getHitPos(t,e,i=.2){const s={x:(e.pageX-this.domElement.offsetLeft)/this.domElement.offsetWidth*2-1,y:(e.pageY-this.domElement.offsetTop)/this.domElement.offsetHeight*-2+1},n=new b;n.setFromCamera(s,this.camera),n.params.Line&&(n.params.Line.threshold=i);const r=n.intersectObject(t.lineMesh);if(0===r.length)return null;return r[Math.floor(r.length/2)].point.divide(this.root.scale)}}const Ot=t=>vt([t])[0];const Pt={coords:[...wt(bt("M 405.13 841.89L 405.138 843.005C 405.143 843.749 405.133 844.867 405.106 846.361C 405.079 847.854 404.991 849.731 404.84 851.99C 404.689 854.25 404.403 856.895 403.982 859.926C 403.561 862.957 402.912 866.327 402.036 870.036C 401.159 873.745 400.116 877.352 398.906 880.858C 397.696 884.363 396.327 887.719 394.799 890.924C 393.271 894.129 391.587 897.175 389.748 900.062C 387.909 902.949 385.911 905.701 383.753 908.317C 381.595 910.932 379.259 913.446 376.744 915.856C 374.23 918.267 371.499 920.602 368.551 922.862C 365.604 925.122 362.374 927.307 358.861 929.416C 355.348 931.526 351.465 933.536 347.212 935.447C 342.959 937.357 338.237 939.129 333.047 940.763C 327.856 942.397 322.098 943.846 315.771 945.111C 309.443 946.375 303.222 947.33 297.108 947.975C 290.994 948.619 285.317 949.064 280.08 949.31C 274.842 949.556 270.329 949.706 266.54 949.76C 262.751 949.814 259.872 949.841 257.903 949.84L 254.95 949.84")),...wt(bt("M -272.323 949.84L -274.216 949.84C -275.478 949.84 -277.346 949.827 -279.82 949.802C -282.293 949.776 -285.308 949.706 -288.865 949.592C -292.423 949.477 -296.422 949.265 -300.865 948.954C -305.308 948.644 -310.072 948.148 -315.159 947.467C -320.245 946.786 -325.118 945.939 -329.777 944.926C -334.437 943.913 -338.902 942.714 -343.173 941.329C -347.444 939.944 -351.535 938.357 -355.446 936.57C -359.357 934.782 -363.093 932.787 -366.653 930.586C -370.213 928.384 -373.591 925.985 -376.788 923.387C -379.985 920.789 -382.987 918.01 -385.795 915.049C -388.602 912.089 -391.2 908.969 -393.589 905.69C -395.978 902.411 -398.144 898.997 -400.089 895.448C -402.033 891.899 -403.751 888.238 -405.243 884.466C -406.735 880.694 -408.004 876.831 -409.052 872.878C -410.099 868.926 -410.869 865.309 -411.362 862.029C -411.854 858.749 -412.191 855.852 -412.372 853.336C -412.553 850.82 -412.662 848.711 -412.7 847.01C -412.737 845.31 -412.755 844.031 -412.753 843.174L -412.75 841.89"))],preTranslate:{x:0,y:-841.89},rotate:-.5*Math.PI,scale:{x:.03937,y:.03937}};class Lt{constructor(t,e={}){var i,s,n,c;this.container=t,this.SHADOWS_ENABLED=!1,this.DEFAULT_SCALE=15,this.GRID_SIZE=100,this.unitScale=1;const a={x:(null==(i=e.size)?void 0:i.x)||window.innerWidth,y:(null==(s=e.size)?void 0:s.y)||window.innerHeight};if(this.scale=new r((null==(n=e.scale)?void 0:n.x)||15,(null==(c=e.scale)?void 0:c.y)||15,1),this.scene=new w,this.scene.background=new z(15790320),this.camera=new S(a.x/-2,a.x/2,a.y/2,a.y/-2,.1,1e3),this.camera.position.set(0,0,100),this.scene.add(this.camera),this.SHADOWS_ENABLED){var h=new f(2e3,2e3);h.rotateX(Math.PI/2);var l=new E({opacity:.2}),u=new o(h,l);u.position.y=-200,u.receiveShadow=!0,this.scene.add(u)}var d;this.gridHelper=this.createGridHelper(this.unitScale),this.scene.add(this.gridHelper),this.renderer=new C({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(a.x,a.y),this.renderer.shadowMap.enabled=this.SHADOWS_ENABLED,this.container.appendChild(this.renderer.domElement),e.showStats&&(this.stats=j(),this.container.appendChild(this.stats.dom)),this.curvesEditor=this.createCurvesEditor(e.coords||(d=Pt).coords.map((t=>{const e=Ot(t).add(Ot(d.preTranslate||{x:0,y:0})).multiply(Ot(d.scale||{x:1,y:1})).rotateAround(Ot({x:0,y:0}),d.rotate||0).add(Ot(d.postTranslate||{x:0,y:0}));return{x:e.x,y:e.y}})));const p=new _(this.camera,this.renderer.domElement);p.dampingFactor=.2,p.minPolarAngle=Math.PI/2,p.maxPolarAngle=Math.PI/2,p.minAzimuthAngle=-.5,p.maxAzimuthAngle=.5,p.mouseButtons={LEFT:O.PAN,RIGHT:O.DOLLY,MIDDLE:O.ROTATE},this.controls=p,this.tippyY=P(this.renderer.domElement,{trigger:"manual",followCursor:"vertical",plugins:[k],placement:"right"}),this.tippyX=P(this.renderer.domElement,{trigger:"manual",followCursor:"horizontal",plugins:[k],placement:"bottom"})}animate(){var t;requestAnimationFrame((()=>this.animate())),this.renderer.render(this.scene,this.camera),null==(t=this.stats)||t.update()}createCurvesEditor(t){console.log("[ShaperApp.createCurvesEditor] coords:",t);const e=new _t(this.camera,this.scene,this.renderer.domElement,vt(t),{SHADOWS_ENABLED:this.SHADOWS_ENABLED,scale:this.scale});return e.controls.hoverObject$.subscribe((t=>this.controls.enabled=!t)),e.controls.hoverObject$.subscribe((t=>{t?(this.tippyX.setContent(this.getTippyCoord(t.position.x)),this.tippyY.setContent(this.getTippyCoord(t.position.y)),this.tippyX.show(),this.tippyY.show()):(this.tippyX.hide(),this.tippyY.hide())})),e.controls.objectMoved$.subscribe((([t,e])=>{this.tippyX.setContent(this.getTippyCoord(t.position.x)),this.tippyY.setContent(this.getTippyCoord(t.position.y))})),e.controls.draggingChanged$.subscribe((t=>{if(!t){const t=this.calculateBoundingBox();console.log("TODO: show bounding box info: ",t," --\x3e width: ",2*t.x.max)}})),e}getTippyCoord(t){return`${(t*this.unitScale+"").substr(0,5)}`}getBeziers(){return this.curvesEditor.segments.map((t=>ft(t)))}setUnitScale(t){this.unitScale=t,this.scene.remove(this.gridHelper),this.gridHelper=this.createGridHelper(this.unitScale),this.scene.add(this.gridHelper)}createGridHelper(t){var e=new L(this.GRID_SIZE*this.scale.x*(1/t),this.GRID_SIZE);e.rotateX(Math.PI/2),e.position.y=0;{const t=e.material;t.opacity=.25,t.transparent=!0}return e}resetViewport(){this.controls.reset()}calculateBoundingBox(){return this.curvesEditor.segments.map((t=>ft(t))).map((t=>t.bbox())).reduce(((t,e)=>({x:{min:t.x.min&&t.x.min<e.x.min?t.x.min:e.x.min,max:t.x.max&&t.x.max>e.x.max?t.x.max:e.x.max},y:{min:t.y.min&&t.y.min<e.y.min?t.y.min:e.y.min,max:t.y.max&&t.y.max>e.y.max?t.y.max:e.y.max}})),{x:{},y:{}})}}class kt{constructor(t,e,i={}){this.svg=t,this.specs=e,this.opts=i}get origin(){var t;return(null==(t=this.opts)?void 0:t.origin)||new l(0,0)}get scale(){var t;return(null==(t=this.opts)?void 0:t.scale)||new l(1,1)}viewbox(){return this.svg.viewbox(-.5*this.specs.maxWidth*this.scale.x,-.5*this.specs.maxHeight*this.scale.y,.5*this.specs.maxWidth*this.scale.x,.5*this.specs.maxHeight*this.scale.y),this}size(){return this.svg.size(this.specs.maxWidth*this.scale.x,this.specs.maxHeight*this.scale.y),this}bezier(t,e=!1){const i=t.points.map((t=>this.toLocal(new l(t.x,e?-1*t.y:t.y)))).map((t=>`${t.x} ${t.y}`));return this.svg.fill("transparent").stroke("#000"),this.svg.path(`M${i[0]} C${i[1]} ${i[2]} ${i[3]}`),this}truckPinsAtCenter(t){const e=this.specs,i=this.scale.x,s=new l(i,i).multiply(new l(e.truckPinDistanceX,e.truckPinDistanceY)),n=e.truckPinRadius*i;return[new l(-.5,.5),new l(-.5,-.5),new l(.5,-.5),new l(.5,.5)].forEach((e=>{const i=t.clone().add(s.clone().multiply(e));this.svg.circle(2*n).center(i.x,i.y).fill("#000")})),this}frontTruckPins(){return this.truckPinsAtCenter(new l(0,0+.5*this.specs.distanceBetweenTrucks+.5*this.specs.truckPinDistanceY).multiply(this.scale).add(this.origin))}backTruckPins(){return this.truckPinsAtCenter(new l(0,0-.5*this.specs.distanceBetweenTrucks-.5*this.specs.truckPinDistanceY).multiply(this.scale).add(this.origin))}anchor(t){const e=this.scale.x;return console.log("origin",this.origin),this.svg.circle(t*e*2).center(this.origin.x,this.origin.y).fill("#000"),this}toLocal(t){return t.clone().multiply(this.scale).add(this.origin)}}class Mt{constructor(t){this.beziers=t}static fromBeziers(t){return new Mt(t)}get raw(){return this.getSvgForBeziers(this.beziers)}getSvg(t=1,e){const i=M(),s=new l(t,t),n=new kt(i,St,{origin:e?new l(e.x,e.y):void 0,scale:s}),r=new kt(i,St,{origin:e?new l(e.x,e.y):void 0,scale:s.clone().multiply(new l(-1,1))});return this.beziers.forEach((t=>{n.bezier(t,!0),r.bezier(t,!0)})),n.backTruckPins().frontTruckPins().anchor(2*St.truckPinRadius),i}getSvgForBeziers(t){return""}}const Dt={name:"Shaper",props:{size:Object,scale:Object},data:()=>({shaperApp:void 0,showSvgPreview:!1,redrawTimeout:void 0}),created:function(){},mounted:function(){const t=document.getElementById("container");if(t){const e=new Lt(t,{size:this.size,scale:this.scale});e.animate(),this.shaperApp=e,this.shaperApp.curvesEditor.change$.subscribe((()=>{this.showSvgPreview&&(clearTimeout(this.redrawTimeout),this.redrawTimeout=setTimeout((()=>{this.redrawSvg()}),50))}))}else console.warn("ShaperApp not initialized")},methods:{setUnitScale:function(t){this.shaperApp.setUnitScale(t)},resetViewport:function(){this.shaperApp.resetViewport()},showSvg:function(t){this.showSvgPreview=!1!==t,t&&this.$nextTick((()=>this.redrawSvg()))},redrawSvg:function(){var t,e,i,s,n,r,o;null==(i=null==(e=null==(t=this.$refs)?void 0:t.svgpreview)?void 0:e.querySelector("svg"))||i.remove(),null==(r=null==(n=null==(s=this.$refs)?void 0:s.svgreal)?void 0:n.querySelector("svg"))||r.remove(),(null==(o=this.$refs)?void 0:o.svgpreview)&&this.generateSvg()},generateSvg:function(){var t,e;const i=this.shaperApp;if(i){const s=i.getBeziers(),n=Mt.fromBeziers(s),r={x:120,y:180};n.getSvg(5,{x:.5*r.x,y:.5*r.y}).size(r.x,r.y).addTo("#svg #preview"),console.log("Applying autodesk scale bug compensation factor:",St.autodeskScaleBugFactor),n.getSvg(100*St.autodeskScaleBugFactor).addTo("#svg #real");const o=null==(t=this.$refs)?void 0:t.svgsource,c=null==(e=this.$refs)?void 0:e.svgreal;o&&(o.value=c?c.innerHTML:"[could not find element]")}}}},At=R("data-v-32be7bb4");D("data-v-32be7bb4");const Ht={id:"container"},Bt={key:0,id:"svg"},Tt={ref:"svgsource",id:"svgSource"},Ft={id:"preview",ref:"svgpreview"},Rt={id:"real",ref:"svgreal"},It={id:"shapeMenu"};A();const Ut=At(((t,e,i,s,n,r)=>(H(),B("div",Ht,[t.showSvgPreview?(H(),B("div",Bt,[T("textarea",Tt,null,512),T("div",Ft,null,512),T("div",Rt,null,512)])):F("",!0),T("div",It,[T("button",{onClick:e[1]||(e[1]=t=>r.showSvg(!0))},"SHOW SVG"),T("button",{onClick:e[2]||(e[2]=t=>r.showSvg(!1))},"HIDE SVG"),T("button",{onClick:e[3]||(e[3]=t=>r.setUnitScale(1))},"USE INCHES"),T("button",{onClick:e[4]||(e[4]=t=>r.setUnitScale(1/2.54))},"USE CMs"),T("button",{onClick:e[5]||(e[5]=t=>r.resetViewport())},"RESET VIEWPORT")])]))));Dt.render=Ut,Dt.__scopeId="data-v-32be7bb4";class $t{static create(t){const e=document.getElementById(t)||document.createElement("div");return e?new $t(e):null}constructor(t){this.el=t}get(t){return this.el?this.el.dataset[t]:void 0}getCoord(t){const e=this.get(t);return e?function(t){var e;const i=null==(e=null==t?void 0:t.split("x"))?void 0:e.map((t=>parseFloat(t)));return i&&2===i.length?{x:i[0],y:i[1]}:void 0}(e):void 0}host(){return this.get("host")||window.location.origin}rootPath(){return this.get("rootpath")||"/wp-json/deckbuilder"}rootUrl(){return this.get("rooturl")||this.host()+this.rootPath()}assetPath(){return this.get("assetpath")||"/wp-content/plugins/deckbuilder/public/shaper/"}}const Nt={name:"App",components:{Shaper:Dt},data:t=>(t.opts().rootUrl(),{size:t.opts().getCoord("size"),scale:t.opts().getCoord("scale")}),methods:{opts:function(){return $t.create("deckbuilder-shaper-opts")}}},Vt={id:"app"};Nt.render=function(t,e,i,s,n,r){const o=I("Shaper");return H(),B("div",Vt,[T(o,{size:t.size,scale:t.scale},null,8,["size","scale"])])},U(Nt).mount("#app");
